deptrac:
  paths:
    - ./app/Domains
  exclude_files:
    - 'vendor/.*'

  layers:
    # Shared contracts and DTOs - accessible by all domains
    - name: Shared
      collectors:
        - type: directory
          value: 'app/Domains/Shared/'

    # Test helpers - can be shared between domain tests
    - name: TestHelpers
      collectors:
        - type: directory
          value: 'app/Domains/Shared/Testing/'

    # Admin Domain
    - name: AdminPrivate
      collectors:
        - type: bool
          must_not:
            - type: directory
              value: app/Domains/Admin/Tests/
          must:
            - type: directory
              value: app/Domains/Admin/

    - name: AdminTests
      collectors:
        - type: directory
          value: 'app/Domains/Admin/Tests/'

    # Auth Domain
    - name: AuthPublic
      collectors:
        - type: directory
          value: 'app/Domains/Auth/PublicApi/'
        - type: directory
          value: 'app/Domains/Auth/Events/'

    - name: AuthPrivate
      collectors:
        - type: bool
          must_not:
            - type: directory
              value: app/Domains/Auth/PublicApi/
            - type: directory
              value: app/Domains/Auth/Events/
            - type: directory
              value: app/Domains/Auth/Tests/
          must:
            - type: directory
              value: app/Domains/Auth/

    - name: AuthTests
      collectors:
        - type: directory
          value: 'app/Domains/Auth/Tests/'

    # Comment Domain
    - name: CommentPublic
      collectors:
        - type: directory
          value: 'app/Domains/Comment/PublicApi/'
        - type: directory
          value: 'app/Domains/Comment/Contracts/'
        - type: directory
          value: 'app/Domains/Comment/Events/'

    - name: CommentPrivate
      collectors:
        - type: bool
          must_not:
            - type: directory
              value: app/Domains/Comment/PublicApi/
            - type: directory
              value: app/Domains/Comment/Contracts/
            - type: directory
              value: 'app/Domains/Comment/Events/'
            - type: directory
              value: app/Domains/Comment/Tests/
          must:
            - type: directory
              value: app/Domains/Comment/

    - name: CommentTests
      collectors:
        - type: directory
          value: 'app/Domains/Comment/Tests/'

    # Dashboard Domain
    - name: DashboardPrivate
      collectors:
        - type: bool
          must_not:
            - type: directory
              value: app/Domains/Dashboard/Tests/
          must:
            - type: directory
              value: app/Domains/Dashboard/

    # Events domains
    - name: EventsPublic
      collectors:
        - type: directory
          value: app/Domains/Events/PublicApi/
        - type: directory
          value: app/Domains/Events/Contracts/
        
    - name: EventsPrivate
      collectors:
        - type: bool
          must_not:
            - type: directory
              value: app/Domains/Events/PublicApi/
            - type: directory
              value: app/Domains/Events/Contracts/
            - type: directory
              value: app/Domains/Events/Tests/
          must:
            - type: directory
              value: app/Domains/Events/

    - name: EventsTests
      collectors:
        - type: directory
          value: app/Domains/Events/Tests/

    # Home Domain
    - name: HomePrivate
      collectors:
        - type: bool
          must_not:
            - type: directory
              value: app/Domains/Home/Tests/
          must:
            - type: directory
              value: app/Domains/Home/

    # News Domain
    - name: NewsPublic
      collectors:
        - type: directory
          value: 'app/Domains/News/PublicApi/'

    - name: NewsPrivate
      collectors:
        - type: bool
          must_not:
            - type: directory
              value: app/Domains/News/PublicApi/
            - type: directory
              value: app/Domains/News/Tests/
          must:
            - type: directory
              value: app/Domains/News/

    - name: NewsTests
      collectors:
        - type: directory
          value: 'app/Domains/News/Tests/'

    # Profile Domain
    - name: ProfilePublic
      collectors:
        - type: directory
          value: 'app/Domains/Profile/Public/'

    - name: ProfilePrivate
      collectors:
        - type: directory
          value: 'app/Domains/Profile/Private/'

    - name: ProfileTests
      collectors:
        - type: directory
          value: 'app/Domains/Profile/Tests/'

    # StaticPage Domain
    - name: StaticPagePublic
      collectors:
        - type: directory
          value: 'app/Domains/StaticPage/PublicApi/'

    - name: StaticPagePrivate
      collectors:
        - type: bool
          must_not:
            - type: directory
              value: app/Domains/StaticPage/PublicApi/
            - type: directory
              value: app/Domains/StaticPage/Tests/
          must:
            - type: directory
              value: app/Domains/StaticPage/

    - name: StaticPageTests
      collectors:
        - type: directory
          value: 'app/Domains/StaticPage/Tests/'

    # Story Domain
    - name: StoryPublic
      collectors:
        - type: directory
          value: 'app/Domains/Story/PublicApi/'

    - name: StoryPrivate
      collectors:
        - type: bool
          must_not:
            - type: directory
              value: app/Domains/Story/PublicApi/
            - type: directory
              value: app/Domains/Story/Tests/
          must:
            - type: directory
              value: app/Domains/Story/

    - name: StoryTests
      collectors:
        - type: directory
          value: 'app/Domains/Story/Tests/'

    # StoryRef Domain
    # The StoryRef Domain is a very dumb one. As such, we do not create public or private APIs for it.
    - name: StoryRef
      collectors:
        - type: directory
          value: app/Domains/StoryRef/

  ruleset:
    # Shared contracts and DTOs - accessible by all domains
    Shared: [ ]

    # Test helpers - accessible by all domain tests
    TestHelpers: [ ]

    # ###################################################
    # Public APIs - can only depend on Shared and their own domain
    # ###################################################
    AuthPublic:
      - Shared
      - AuthPrivate
      - EventsPublic

    CommentPublic: 
      - Shared
      - AuthPublic
      - CommentPrivate
      - EventsPublic

    EventsPublic:
      - Shared
      - EventsPrivate

    NewsPublic:
      - Shared
      - NewsPrivate
      - EventsPublic

    ProfilePublic:
      - Shared
      - ProfilePrivate
      - AuthPublic
      - EventsPublic

    StaticPagePublic:
      - Shared
      - StaticPagePrivate
      - EventsPublic

    StoryPublic:
      - CommentPublic
      - Shared
      - StoryPrivate
      - StoryRef
      - EventsPublic

    StoryRef:
      - Shared
      - EventsPublic

    # ###################################################
    # Private domains - can access Shared + other domain Public APIs + events
    # ###################################################

    # [Exception] Admin can use both Public and Private parts
    # This is because the Admin dashboards are centered in this module
    # But they actually could be spread in their own modules
    AdminPrivate:
      - Shared
      - AuthPublic
      - AuthPrivate
      - NewsPublic
      - NewsPrivate
      - ProfilePublic
      - ProfilePrivate
      - StaticPagePublic
      - StaticPagePrivate
      - StoryPublic
      - StoryPrivate
      - StoryRef
      - DashboardPrivate
      - HomePrivate
      - EventsPublic
      - EventsPrivate

    AuthPrivate:
      - Shared
      - AuthPublic
      - EventsPublic
 
    CommentPrivate:
      - Shared
      - AuthPublic
      - CommentPublic
      - EventsPublic

    DashboardPrivate:
      - Shared
      - AuthPublic

    EventsPrivate:
      - Shared
      - EventsPublic

    HomePrivate:
      - Shared
      - AuthPublic
      - NewsPublic

    NewsPrivate:
      - Shared
      - AuthPublic
      - EventsPublic

    ProfilePrivate:
      - Shared
      - AuthPublic
      - EventsPublic
      - ProfilePublic

    StaticPagePrivate:
      - Shared
      - AuthPublic
      - EventsPublic

    StoryPrivate:
      - Shared
      - AuthPublic
      - CommentPublic
      - ProfilePublic
      - StoryRef
      - EventsPublic

    # ###################################################
    # Domain tests - can access their own domain + Public APIs + ALL test modules for data creation
    # ###################################################
    AuthTests:
      - Shared
      - TestHelpers
      - AuthPrivate
      - AuthPublic

    CommentTests:
      - TestHelpers
      - CommentPrivate
      - CommentPublic

    EventsTests:
      - TestHelpers
      - EventsPrivate
      - EventsPublic

    NewsTests:
      - Shared
      - TestHelpers
      - NewsPrivate
      - NewsPublic
      - AuthPublic

    ProfileTests:
      - Shared
      - TestHelpers
      - ProfilePrivate
      - ProfilePublic
      - AuthPublic


    StaticPageTests:
      - Shared
      - TestHelpers
      - StaticPagePrivate
      - StaticPagePublic
      - AuthPublic

    StoryTests:
      - Shared
      - TestHelpers
      - StoryPrivate
      - StoryPublic
      - AuthPublic
      - ProfilePublic
      - StoryRef

    AdminTests:
      - Shared
      - TestHelpers
      - AdminPrivate
      - AuthPublic
      - NewsPublic
      - ProfilePublic
      - StaticPagePublic
      - StoryPublic
      - StoryRef
